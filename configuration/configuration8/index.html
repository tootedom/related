<!doctype html>




<!--[if IE 9]><html class="lt-ie10" lang="en" > <![endif]-->
<html class="no-js" lang="en" data-useragent="Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.2; Trident/6.0)">   
  
  
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <title>Provisioning</title>
    

    
    <meta name="description" content="Details of Playground that is available for download."/>
    
    
    <meta name="author" content="Dominic Tootell" />
    <meta name="copyright" content="relate it (c) 2013-2014" />
    <link rel="shortcut icon" href="http://relateit.io/favicon.ico" />

	<link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
    <link rel="stylesheet" href="http://relateit.io/stylesheets/foundation.css" />
    <script src="http://relateit.io/javascripts/vendor/modernizr.js"></script>
</head>


  <body>
    

<!-- Nav Bar -->

  <header class="inner">

	<nav>	  
	  <div class="row">	  	
	    <div class="large-12 columns">	      
	      <div class="nav-bar right" style="padding-top: 30px">
	       <ul class="button-group">
	         <li><a href='http://relateit.io/index.html' class="radius small button">Home</a></li>	         
	         <li><a href='http://relateit.io/indexing/index.html' class="radius small button">Indexing</a><br/></li>
	         <li><a href='http://relateit.io/searching/index.html' class="radius small button">Searching</a><br/></li>							 
	         <li><a href='http://relateit.io/configuration/index.html' class="radius small button">Configuration</a></li>
	         <li><a href='http://relateit.io/blog/index.html' class="radius small button">Blog</a></li>
	         <li><a href='http://relateit.io/downloads.html'  class="radius small button">Downloads</a></li>         
	        </ul>
	      </div>
	      <h1><a href='https://github.com/tootedom/related'><img src="http://relateit.io/images/relateitlogo.png"></a></h1>
	      <hr />
	    </div>
	  </div>
	</nav>	
</header>


  <!-- End Nav -->
  

  <div class="off-canvas-wrap">
  <div class="inner-wrap">

<nav class="tab-bar show-for-small">
  <a class="left-off-canvas-toggle menu-icon">
    <span></span>
  </a>
</nav>

<aside class="left-off-canvas-menu">

  <div class="sidebar-offcanvas">
          <h5>Documentation:</h5>          
          <nav>
            <ul class="off-canvas-list">
              <li class="heading">Indexing</li>
              
              
                
              
              

 

	<li><a href="http://relateit.io/indexing/indexing1" data-search>Overview</a></li>


 

	<li><a href="http://relateit.io/indexing/indexing2" data-search>Dates</a></li>


 

	<li><a href="http://relateit.io/indexing/indexing3" data-search>Document Format</a></li>


 

	<li><a href="http://relateit.io/indexing/indexing4" data-search>Properties</a></li>


 

	<li><a href="http://relateit.io/indexing/indexing5" data-search>Logging</a></li>


 

	<li><a href="http://relateit.io/indexing/indexing6" data-search>Document Info</a></li>


              <li class="divider"></li>
              <li class="heading">Searching</li>
              
              
                
              
              

 

	<li><a href="http://relateit.io/searching/searching1" data-search>Overview</a></li>


 

	<li><a href="http://relateit.io/searching/searching2" data-search>Filters</a></li>


 

	<li><a href="http://relateit.io/searching/searching3" data-search>Logging</a></li>


 

	<li><a href="http://relateit.io/searching/searching4" data-search>Indexes</a></li>


 

	<li><a href="http://relateit.io/searching/searching5" data-search>Aliases</a></li>


              <li class="divider"></li>
              <li class="heading">Configuration</li>
              
              
                
              
              

 

	
	<li><a href="http://relateit.io/configuration/configuration1" data-search>ES Connections</a></li>
	


 

	
	<li><a href="http://relateit.io/configuration/configuration2" data-search>ES Type Mapping</a></li>
	


 

	
	<li><a href="http://relateit.io/configuration/configuration3" data-search>ES Configuration</a></li>
	


 

	
	<li><a href="http://relateit.io/configuration/configuration4" data-search>Webapp JVM</a></li>
	


 

	
	<li><a href="http://relateit.io/configuration/configuration5" data-search>App Config</a></li>
	


 

	
	<li><a href="http://relateit.io/configuration/configuration6" data-search>Tomcat</a></li>
	


 

	
	<li><a href="http://relateit.io/configuration/configuration7" data-search>Diagrams</a></li>
	


 

	
	<li><a href="http://relateit.io/configuration/configuration8" data-search class="active">Provisioning</a></li>
	


            </ul>
          </nav>
        </div> 

 
</aside>

<a class="exit-off-canvas" href="#"></a>


  <!-- Main Page Content and Sidebar -->

  <div class="row">
        <div class="large-3 medium-4 columns">
      <div class="hide-for-small">
        <div class="sidebar">
          <h5>Documentation:</h5>          
          <nav>
            <ul class="side-nav">
              <li class="heading">Indexing</li>
              
              
                
              
              

 

	<li><a href="http://relateit.io/indexing/indexing1" data-search>Overview</a></li>


 

	<li><a href="http://relateit.io/indexing/indexing2" data-search>Dates</a></li>


 

	<li><a href="http://relateit.io/indexing/indexing3" data-search>Document Format</a></li>


 

	<li><a href="http://relateit.io/indexing/indexing4" data-search>Properties</a></li>


 

	<li><a href="http://relateit.io/indexing/indexing5" data-search>Logging</a></li>


 

	<li><a href="http://relateit.io/indexing/indexing6" data-search>Document Info</a></li>


              <li class="divider"></li>
              <li class="heading">Searching</li>
              
              
                
              
              

 

	<li><a href="http://relateit.io/searching/searching1" data-search>Overview</a></li>


 

	<li><a href="http://relateit.io/searching/searching2" data-search>Filters</a></li>


 

	<li><a href="http://relateit.io/searching/searching3" data-search>Logging</a></li>


 

	<li><a href="http://relateit.io/searching/searching4" data-search>Indexes</a></li>


 

	<li><a href="http://relateit.io/searching/searching5" data-search>Aliases</a></li>


              <li class="divider"></li>
              <li class="heading">Configuration</li>
              
              
                
              
              

 

	
	<li><a href="http://relateit.io/configuration/configuration1" data-search>ES Connections</a></li>
	


 

	
	<li><a href="http://relateit.io/configuration/configuration2" data-search>ES Type Mapping</a></li>
	


 

	
	<li><a href="http://relateit.io/configuration/configuration3" data-search>ES Configuration</a></li>
	


 

	
	<li><a href="http://relateit.io/configuration/configuration4" data-search>Webapp JVM</a></li>
	


 

	
	<li><a href="http://relateit.io/configuration/configuration5" data-search>App Config</a></li>
	


 

	
	<li><a href="http://relateit.io/configuration/configuration6" data-search>Tomcat</a></li>
	


 

	
	<li><a href="http://relateit.io/configuration/configuration7" data-search>Diagrams</a></li>
	


 

	
	<li><a href="http://relateit.io/configuration/configuration8" data-search class="active">Provisioning</a></li>
	


            </ul>
          </nav>
        </div> 
      </div>
    </div>
    <!-- Main Blog Content -->
    <div class="large-9 medium-8 columns" role="content">
    
    <div class="magellan-container" data-magellan-expedition="fixed" style="left: auto;">
      <dl class="sub-nav">        
        
        
         
        
          <dd data-magellan-arrival="1" ><a href="http://relateit.io/configuration/configuration1">ES Connections</a></dd>
        
        <li class="divider">|</li>
        
         
        
          <dd data-magellan-arrival="2" ><a href="http://relateit.io/configuration/configuration2">ES Type Mapping</a></dd>
        
        <li class="divider">|</li>
        
         
        
          <dd data-magellan-arrival="3" ><a href="http://relateit.io/configuration/configuration3">ES Configuration</a></dd>
        
        <li class="divider">|</li>
        
         
        
          <dd data-magellan-arrival="4" ><a href="http://relateit.io/configuration/configuration4">Webapp JVM</a></dd>
        
        <li class="divider">|</li>
        
         
        
          <dd data-magellan-arrival="5" ><a href="http://relateit.io/configuration/configuration5">App Config</a></dd>
        
        <li class="divider">|</li>
        
         
        
          <dd data-magellan-arrival="6" ><a href="http://relateit.io/configuration/configuration6">Tomcat</a></dd>
        
        <li class="divider">|</li>
        
         
        
          <dd data-magellan-arrival="7" ><a href="http://relateit.io/configuration/configuration7">Diagrams</a></dd>
        
        <li class="divider">|</li>
        
         
        
          <dd data-magellan-arrival="8" class="active"><a href="http://relateit.io/configuration/configuration8">Provisioning</a></dd>       
        
        <li class="divider">|</li>
                
      </dl>
</div>      

    <h1><a href="/configuration/configuration8">Provisioning</a></h1>
    <h1 id="overview">Overview</h1>

<p>A Vagrant Box has been created (The vagrant box is a VirtualBox Centos 6.5 VM), that contains the Relate It application (Search and Indexing); and an instance of Elasticsearch.</p>

<p>This vagrant box is provided as a playground for you to experiment with the Relate It application and that of elasticsearch. The vagrant box has been pre-created using Vagrant 1.4.3 and Ansible 1.4.5. The <code>Vagrantfile</code> and the playbook for creating the vm can be found at: <a href="https://github.com/tootedom/related/tree/master/provisioning/ansible-playground">Relate it playground provisioning</a>.</p>
<hr />
<h2 id="playground_requirements">Playground Requirements</h2>

<p>In order to use the Playground you need two pieces of software</p>

<ul>
<li><a href="https://www.virtualbox.org/wiki/Downloads">Virtual Box 4.3.6+</a></li>

<li><a href="http://www.vagrantup.com/downloads.html">Vagrant 1.4.3+</a></li>
</ul>

<p>Please down load and install the above.</p>
<hr />
<h2 id="add_and_download_the_vagrant_playground_box">Add and Download the vagrant playground box</h2>

<p>Run the following command to install the box into Vagrant. This command will download the .box file and install it into Vagrant.</p>

<pre><code>vagrant box add relateitplayground http://bit.ly/1fFxBrn  </code></pre>

<p>One downloaded you sill be able to run <code>vagrant box list</code> and it will show you the ‘Vagrant’ boxes you have available on your machine:</p>

<pre><code> &gt; vagrant box list
 relateitplayground       (virtualbox)    </code></pre>

<p>Once the vagrant box has “added”, the create a new directory and change into it. Inside that directory create a file named <code>Vagrantfile</code>, and put the following in it:</p>

<pre><code>Vagrant.configure(&quot;2&quot;) do |config|
  config.vm.define &quot;relateit&quot; do |conf|
    conf.vm.hostname = &quot;relateit&quot;
    conf.vm.box = &quot;relateitplayground&quot;
    conf.vm.network &quot;forwarded_port&quot;, guest: 8080, host: 28080
    conf.vm.network &quot;forwarded_port&quot;, guest: 9200, host: 29200         
    conf.vm.provider &quot;virtualbox&quot; do |v|
      v.memory = 2048
    end
  end
end    </code></pre>

<p>Once added run:</p>

<pre><code>vagrant up</code></pre>

<p>This will start the Virtual Machine which will have the following ports forwarded to the virtual machine:</p>

<ul>
<li>28080 forwarding to 8080 (tomcat http) on the VM</li>

<li>29200 forwarding to 9200 (elasticsearch http) on the VM</li>
</ul>

<p>To log into the virtual machine you can run <code>vagrant ssh</code></p>

<p>The relateit searching and web application is running in the tomcat at <code>/usr/share/tomcat</code>. This can be stopped and started with</p>

<pre><code>service tomcat stop
service tomcat start</code></pre>

<p>The elasticsearch instance can be stopped an started with the following:</p>

<pre><code>service elasticsearch stop
service elasticsearch start</code></pre>

<p>When the machine is started with vagrant the tomcat and elasticsearch instance will be start when the Virtual Machine starts</p>

<p>This means for indexing or searching you can execute requests against port 28080 locally, which will be automatically routed to port 8080 on the VM. For example</p>

<p>To index a related item execute the following</p>

<pre><code>curl -H&quot;Content-Type:text/json&quot; -XPOST -v http://localhost:28080/indexing/index -d &#39;
{
   &quot;channel&quot;:&quot;de&quot;,
   &quot;site&quot;:&quot;amazon&quot;,
   &quot;items&quot;:[
      {
         &quot;id&quot;:&quot;1&quot;,
         &quot;type&quot;:&quot;map&quot;
      },
      {
         &quot;id&quot;:&quot;2&quot;,
         &quot;type&quot;:&quot;compass&quot;
      },
      {
         &quot;id&quot;:&quot;3&quot;,
         &quot;type&quot;:&quot;torch&quot;
      },
      {
         &quot;id&quot;:&quot;4&quot;,
         &quot;type&quot;:&quot;torch&quot;,
         &quot;channel&quot;:&quot;uk&quot;
      }
    ]
}&#39;</code></pre>

<p>After waiting a second or two, you should be able to execute the following search and obtain a result (the default install of elasticsearch commits every 1second).</p>

<pre><code>curl http://localhost:28080/searching/frequentlyrelatedto/1    </code></pre>
<hr />
<h2 id="how_the_playground_was_created">How the Playground was created</h2>

<p>The source for the provisioning can be found here:</p>

<ul>
<li><a href="https://github.com/tootedom/related/tree/master/provisioning/ansible-playground">Relate it playground provisioning</a>.</li>
</ul>

<p>This folder contains a ansible playbook that installs on a Vagrant vm the relate it application and elasticsearch.</p>

<h2 id="development_standalone_relate_it_virtual_machine">Development standalone Relate it virtual machine.</h2>

<ul>
<li>Requires Ansible 1.4 or newer</li>

<li>Requires Virtualbox 4.3.6+</li>

<li>Requires Vagrant 1.4.3 and CentOS/RHEL 6.x hosts from https://github.com/2creatives/vagrant-centos/releases/tag/v6.5.1</li>
</ul>

<h2 id="installing_ansible">Installing ansible</h2>

<p>Details for installing ansible can be found at: http://docs.ansible.com/intro_installation.html However, for a quick step guide for installation on Mac OS X.</p>

<pre><code>sudo easy_install pip
sudo pip install ansible</code></pre>

<p>To upgrade after install run:</p>

<pre><code>sudo pip install ansible --upgrade</code></pre>

<p>If you get the following error: <code>configure: error: cannot find sources (src/pycrypto_compat.h)</code> Then it could be one of two things:</p>

<p><strong>1)</strong> Out of date XCode it’s an xcode thing <strong>2)</strong> Or you need to install pycyrpto from source (http://superuser.com/questions/259278/python-2-6-1-pycrypto-2-3-pypi-package-broken-pipe-during-build) when compiling pycrypto</p>

<p>If (2) try to do the following:</p>

<pre><code>download pycrpto source (https://www.dlitz.net/software/pycrypto/):
untar and cd into it
run: ./configure
sudo python ./setup.py build
sudo python ./setup.py install    </code></pre>

<h2 id="install_virtual_box">Install Virtual box</h2>

<p>Install Virtual box from https://www.virtualbox.org/wiki/Downloads</p>

<h2 id="vagrant">Vagrant</h2>

<p>Install vagrant from http://www.vagrantup.com/downloads.html</p>

<p>Then add the following box:</p>

<pre><code>vagrant box add centos65-x86_64-20131205 https://github.com/2creatives/vagrant-centos/releases/download/v6.5.1/centos65-x86_64-20131205.box</code></pre>

<h2 id="buildingprovisioning_the_vagrant_virtual_machine">Building/Provisioning the Vagrant virtual machine</h2>

<p>The Vagrant/Ansible provisioning in this folder creates a vm that has:</p>

<ul>
<li>Elasticsearch 1.0.0</li>

<li>Relateit Indexing and Searching application on tomcat 7.0.52, on Oracle jdk1.7.0_51</li>
</ul>

<p>Provisioning the vm is a matter of running <code>vagrant up</code></p>

<pre><code>vagrant up</code></pre>

<h2 id="talking_to_the_indexing_and_search_application_on_the_virtual_machine">Talking to the Indexing and Search application on the Virtual Machine</h2>

<p>The virtual machine, when started by Vagrant, has the following ports forwarded to the virtual machine:</p>

<ul>
<li>28080 forwarding to 8080 (tomcat http) on the VM</li>

<li>29200 forwarding to 9200 (elasticsearch http) on the VM</li>
</ul>

<p>This means for indexing or searching you can execute requests against port 28080 locally, which will be automatically routed to port 8080 on the VM. For example</p>

<p>To index a related item execute the following</p>

<pre><code>curl -H&quot;Content-Type:text/json&quot; -XPOST -v http://localhost:28080/indexing/index -d &#39;
{
   &quot;channel&quot;:&quot;de&quot;,
   &quot;site&quot;:&quot;amazon&quot;,
   &quot;items&quot;:[
      {
         &quot;id&quot;:&quot;1&quot;,
         &quot;type&quot;:&quot;map&quot;
      },
      {
         &quot;id&quot;:&quot;2&quot;,
         &quot;type&quot;:&quot;compass&quot;
      },
      {
         &quot;id&quot;:&quot;3&quot;,
         &quot;type&quot;:&quot;torch&quot;
      },
      {
         &quot;id&quot;:&quot;4&quot;,
         &quot;type&quot;:&quot;torch&quot;,
         &quot;channel&quot;:&quot;uk&quot;
      }
    ]
}&#39;</code></pre>

<p>After waiting a second or two, you should be able to execute the following search and obtain a result (the default install of elasticsearch commits every 1second).</p>

<pre><code>curl http://localhost:28080/searching/frequentlyrelatedto/1    </code></pre>

<!--       <article>

        <h3><a href="#">Blog Post Title</a></h3>
        <h6>Written by <a href="#">John Smith</a> on August 12, 2012.</h6>

        <div class="row">
          <div class="large-6 columns">
            <p>Bacon ipsum dolor sit amet nulla ham qui sint exercitation eiusmod commodo, chuck duis velit. Aute in reprehenderit, dolore aliqua non est magna in labore pig pork biltong. Eiusmod swine spare ribs reprehenderit culpa.</p>
            <p>Boudin aliqua adipisicing rump corned beef. Nulla corned beef sunt ball tip, qui bresaola enim jowl. Capicola short ribs minim salami nulla nostrud pastrami.</p>
          </div>
          <div class="large-6 columns">
            <img src="http://placehold.it/400x240&text=[img]" />
          </div>
        </div>

        <p>Pork drumstick turkey fugiat. Tri-tip elit turducken pork chop in. Swine short ribs meatball irure bacon nulla pork belly cupidatat meatloaf cow. Nulla corned beef sunt ball tip, qui bresaola enim jowl. Capicola short ribs minim salami nulla nostrud pastrami. Nulla corned beef sunt ball tip, qui bresaola enim jowl. Capicola short ribs minim salami nulla nostrud pastrami.</p>

        <p>Pork drumstick turkey fugiat. Tri-tip elit turducken pork chop in. Swine short ribs meatball irure bacon nulla pork belly cupidatat meatloaf cow. Nulla corned beef sunt ball tip, qui bresaola enim jowl. Capicola short ribs minim salami nulla nostrud pastrami.</p>

      </article>

      <hr />

      <article>

        <h3><a href="#">Blog Post Title</a></h3>
        <h6>Written by <a href="#">John Smith</a> on August 12, 2012.</h6>

        <div class="row">
          <div class="large-6 columns">
            <p>Bacon ipsum dolor sit amet nulla ham qui sint exercitation eiusmod commodo, chuck duis velit. Aute in reprehenderit, dolore aliqua non est magna in labore pig pork biltong. Eiusmod swine spare ribs reprehenderit culpa.</p>
            <p>Boudin aliqua adipisicing rump corned beef. Nulla corned beef sunt ball tip, qui bresaola enim jowl. Capicola short ribs minim salami nulla nostrud pastrami.</p>
          </div>
          <div class="large-6 columns">
            <img src="http://placehold.it/400x240&text=[img]" />
          </div>
        </div>

        <p>Pork drumstick turkey fugiat. Tri-tip elit turducken pork chop in. Swine short ribs meatball irure bacon nulla pork belly cupidatat meatloaf cow. Nulla corned beef sunt ball tip, qui bresaola enim jowl. Capicola short ribs minim salami nulla nostrud pastrami. Nulla corned beef sunt ball tip, qui bresaola enim jowl. Capicola short ribs minim salami nulla nostrud pastrami.</p>

        <p>Pork drumstick turkey fugiat. Tri-tip elit turducken pork chop in. Swine short ribs meatball irure bacon nulla pork belly cupidatat meatloaf cow. Nulla corned beef sunt ball tip, qui bresaola enim jowl. Capicola short ribs minim salami nulla nostrud pastrami.</p>

      </article> -->

    </div>

    <!-- End Main Content -->


    <!-- Sidebar -->

<!--     <aside class="large-3 columns">

      <h5>Categories</h5>
      <ul class="side-nav">
        <li><a href="#">News</a></li>
        <li><a href="#">Code</a></li>
        <li><a href="#">Design</a></li>
        <li><a href="#">Fun</a></li>
        <li><a href="#">Weasels</a></li>
      </ul>

      <div class="panel">
        <h5>Featured</h5>
        <p>Pork drumstick turkey fugiat. Tri-tip elit turducken pork chop in. Swine short ribs meatball irure bacon nulla pork belly cupidatat meatloaf cow.</p>
        <a href="#">Read More &rarr;</a>
      </div>

    </aside> -->

    <!-- End Sidebar -->
  </div>

  <!-- End Main Content and Sidebar -->

      <div class="pagination-centered">
      <ul class="pagination">
      
      
      
         
        
        <li><a href="http://relateit.io/configuration/configuration1">1</a></li>
        
      
         
        
        <li><a href="http://relateit.io/configuration/configuration2">2</a></li>
        
      
         
        
        <li><a href="http://relateit.io/configuration/configuration3">3</a></li>
        
      
         
        
        <li><a href="http://relateit.io/configuration/configuration4">4</a></li>
        
      
         
        
        <li><a href="http://relateit.io/configuration/configuration5">5</a></li>
        
      
         
        
        <li><a href="http://relateit.io/configuration/configuration6">6</a></li>
        
      
         
        
        <li><a href="http://relateit.io/configuration/configuration7">7</a></li>
        
      
         
        
        <li class="current"><a href="http://relateit.io/configuration/configuration8">8</a></li>
        
      
      </ul>
    </div>

  <!-- Footer -->
  </div>
</div>
<footer class="row">
    <div class="large-12 columns">
      <hr />
      <div class="row">
        <div class="large-6 columns">
          <p class="copyright">&copy; relate it maintained by <a href="https://github.com/tootedom">tootedom</a></p>
        </div>
        <div class="large-6 columns">
          <ul class="inline-list right">
            <li><a href="https://github.com/tootedom/related"><i class="fa fa-github"></i> Relate it (Source)</a></li>
            <li><address><a href="mailto:dominic.tootell@relateit.io"><i class="fa fa-envelope"></i> Dominic Tootell</a></address></li>
            <li><a href="https://twitter.com/tootedom"><i class="fa fa-twitter"></i>@tootedom</a></li>
          </ul>
        </div>
      </div>
    </div>
</footer>
<script src="http://relateit.io/javascripts/vendor/jquery.js"></script>
<script src="http://relateit.io/javascripts/foundation/foundation.js"></script>
<script src="http://relateit.io/javascripts/foundation/foundation.dropdown.js"></script>
<script src="http://relateit.io/javascripts/foundation/foundation.magellan.js"></script>
<script src="http://relateit.io/javascripts/foundation/foundation.offcanvas.js"></script>
<script>
      $(document).foundation({
        // specify the class used for active dropdowns
        active_class: 'open'
      });

      var doc = document.documentElement;
      doc.setAttribute('data-useragent', navigator.userAgent);
</script>

  <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-47714522-1");
            pageTracker._trackPageview();
            } catch(err) {}
</script>
  </body>
</html>

